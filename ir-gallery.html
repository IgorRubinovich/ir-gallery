<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../rv-iscroll/rv-iscroll.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">
<link rel="import" href="../neon-animation/neon-animation.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../paper-radio-group/paper-radio-group.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<!-- link rel="import" href="ir-gallery-style.html" -->

<script rel="import" src="../iscroll/build/iscroll.js"></script>
<script src="../css-element-queries/src/ResizeSensor.js"></script>

<dom-module id="ir-gallery">
	<style> 
		:host {
			overflow : hidden
		}
		
		#contentNode { display : none }
		
		.viewPort {
			height :600px;
			width : 400px;
			overflow : hidden;
			margin : 0;
			padding : 0;
			background : transparent;
		}

		.wrapper {
			position: relative;

			overflow: hidden;

			/* Prevent native touch events on Windows */
			-ms-touch-action: none;

			/* Prevent the callout on tap-hold and text selection */
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;

			/* Prevent text resize on orientation change, useful for web-apps */
			-webkit-text-size-adjust: none;
			-moz-text-size-adjust: none;
			-ms-text-size-adjust: none;
			-o-text-size-adjust: none;
			text-size-adjust: none;
		}
		
		.wrapper.main,.main {
			width: 100%;
			height : 500px;
			padding : 0;
		}
		.wrapper.thumbnails, .thumbnails {
			padding : 0;
		}
		
		.thumbnails {
			cursor : pointer
		}

		.main iron-image {
			width : 200px
		}
		.scroller iron-image {
			width : 200px
		}
		
		.scroller {
			abackground-color : #ddee00;
			position: absolute;

			/* Prevent elements to be highlighted on tap */
			-webkit-tap-highlight-color: rgba(0,0,0,0);

			/* Put the scroller into the HW Compositing layer right from the start */
			-webkit-transform: translateZ(0);
			-moz-transform: translateZ(0);
			-ms-transform: translateZ(0);
			-o-transform: translateZ(0);
			transform: translateZ(0);
			
			/*width : 600px;
			height : 200px;*/
		
			display : flex;
			left : 0;
		}
		
		figure {
			margin : 0 auto auto;
		}
		figcaption {
		}		

		.slide {
			/*float: left;*/
			/*border : 1px solid red;*/
			@apply(--slide-mixin)
		}
		
		paper-dialog {
			background : transparent;
			overflow : hidden;
			position : fixed;
			left : 0;
			top : 0;
			bottom : 0;
			right 0;
		}
		
		.wrapper {
		}
	</style>
	<template>
		<div id="container">
			<div class="viewPort" id="inlineContainer"></div>
			<paper-dialog id="dialog" with-backdrop><div class="viewPort" id="dialogContainer"></div></paper-dialog>
			<div id="contentNode"><content></content></div>
		</div>
	</template>

</dom-module>


<dom-module id="ir-gallery-echo-html">

  <template>
	<span id="content"></span>
  </template>

  <script>
	Polymer({
	  is: 'ir-gallery-echo-html',
	  properties: {
		  html: {
			  type: String,
			  value: '',
			  observer : 'htmlChanged'
		  }
	  },
		htmlChanged: function() {
		this.$.content.innerHTML = this.html;
		  //this.innerHTML = this.html;
	  }
	});
  </script>

</dom-module>

<dom-module id="ir-gallery-theme">
	<template>
	  <content id="templates"></content>
	</template>
</dom-module>

<script>
(function() {
  "use strict";

  var themes  = {};

  Polymer({
	is : "ir-gallery-theme",

	properties : {
	  templateItem :  { type : Object, notify : true },
	  name :		  { type : String, notify : true }
	},

	behaviors : [
	  Polymer.Templatizer
	],

	attached : function() {

	  var templates = Polymer.dom(this.$.templates).getDistributedNodes(),
		  inlineTemplate,
		  dialogTemplate;
	  	  
	  for(var i = 0; i < templates.length; i++)
		if(templates[i].tagName == "TEMPLATE")
		  if(templates[i].hasAttribute('inline'))
			inlineTemplate = templates[i];
		  else
			if(templates[i].hasAttribute('dialog'))
			  dialogTemplate = templates[i];   

	  inlineTemplate.className = "";
	  dialogTemplate.className = "";

	  themes[this.name] = { inline : inlineTemplate, dialog : dialogTemplate, name : this.name };

	  this.fire('ir-gallery-theme-ready', { inline : inlineTemplate, dialog : dialogTemplate, name : this.name });
	}
  });

  Polymer({
			is : 'ir-gallery',

			properties : {
				images  :		   { type : Array, value : function() { return [] } },
				imgSrc :			{ type : String },
				imgCaption :		{ type : String },
				imagesReady : 		{ type : Boolean, value : false },
				negativeHeight :	{ type : Number, value : 40 },
				showDefaultImages : { type : Boolean, value : false },
				isItFirstTime :	 { type : Boolean, value : false },
				onePictureMode :	{ type : Boolean, value : false },
				inlineMode :		{ type : Boolean, value : false },
				galleryMode :	   { type : Boolean, value : false },
				pageToSwap :		{ type : Number, value : 0 },
				theme :			 { type : String, notify : true, value : "default" },
				nameThemes :		{ type : Array, value : [] },
				themeSelected :	 { type : String, value : "default"},
				themes : { type : Object, value : themes },
				ratio : { type : Number, value : .65 },
				currentPage : { type : Number, value : 0 },
				scrollers : { type : Object, value : function() { return {} } }
			},
			
			behaviors : [
				Polymer.Templatizer
			],
			
			ready : function () {
				/*window.addEventListener('resize', function() {
					//this.debounce(function() { 
					this.init.call(this);
					//}, 300);
				}.bind(this));*/
				
				//var element = document.getElementById('this');
			},
			
			
			attached : function () {
				this.resetDimensions();
				this.init();
				this.firstPass = true;
				new ResizeSensor(this.offsetParent, function() {
					this.resetDimensions();
					this.init();
				}.bind(this));
				Polymer.dom(this.$.contentNode).observeNodes(function(info) {
					this.init();
				}.bind(this))
			},
			
			resetDimensions : function() {
				this.dimensions = 
				{
					inline : { wanted : {}, actual : {}, refit : {} },
					dialog : { wanted : {}, actual : {}, refit : {} }
				}
			},
			
			refit : function(section) {
				this.$.container.style.visibility = "hidden";
				this.debounce('refit', function() {
					var cont = this.$[section + "Container"],
						hNeedsRefit = this.dimensions[section].wanted.height < cont.scrollHeight;
					
					this.dimensions[section].refit.height = 2 * this.dimensions[section].wanted.height - cont.scrollHeight;

					console.log('needs refit: ', hNeedsRefit, 'container height: ', cont.scrollHeight, "should refit content to", this.dimensions[section].refit.height);
					
					//console.log("height did fit: ", hNeedsRefit);
					//this._refitHeight = 2 * this._height - cont.scrollHeight;
					//this._refitWidth = 2 * this._width - cont.scrollWidth;
	
					if(hNeedsRefit)
						this.init(section);
					else
					{
						this.debounce('visibility' + section, function() {
							this.$.container.style.visibility = "visible";
						}, 100);
					}
				}.bind(this), 100);
			},
			
			init : function(section) {
				var initialized, apply;
				
				if(!section)
					section = 'inline';
				
				this.$.container.style.visibility = "hidden";
				
				this.clearAll();
				this.scanForImages();
				
				apply = function() { 
					if(initialized)
						return;
					this.applyTheme('inline', this.refit.bind(this, 'inline'));
					if(this.$.dialog.opened)
					{
						this.$.dialog.refit();
						this.async(function() {
							this.applyTheme('dialog', this.refit.bind(this, 'dialog'));
						}, 100);
					}
					initialized = true;
				}.bind(this);
				
				if(this.themes[this.theme])
					apply();
				else
				{
					document.addEventListener('ir-gallery-theme-ready', function(ev) {
						if(ev.detail.name == this.theme)
							apply(); //(themes[this.theme].inline, themes[this.theme].dialog, true);
					}.bind(this));

					// if nothing happened within 5 seconds the template is probably not available and we should use the default
					this.async(apply, 100);
				}
			},

			clearAll : function(filter) {
				this.clearScrollers(filter);
				if(!filter || filter == 'inline') Polymer.dom(this.$.inlineContainer).innerHTML = '';
				if(!filter || filter == 'dialog') Polymer.dom(this.$.dialogContainer).innerHTML = '';
				Polymer.dom.flush();
			},
			
			isCaptionWrapper : function(el) {
				return el.nodeName == 'FIGURE';
			},
			
			getCaptionHTML : function(el) {
				return Polymer.dom(Polymer.dom(el).querySelector('figcaption')).innerHTML;
			},
			
			getImageCaption : function(img) {
				var captionHolder, captonChildren = [];
				if(this.isCaptionWrapper(img.parentNode))
					return Polymer.dom(Polymer.dom(img.parentNode).querySelector('figcaption')).innerHTML;
					
				return;
			},
			
			scanForImages : function() {
				var imgs = Polymer.dom(this).querySelectorAll('img');
				
				this.images = [];
				
				imgs.forEach(function(img, i) {
					var imgData = 	{
										src : img.src, 
										captionHTML : this.getImageCaption(img), 
										index : i
									};
									
					this.images.push(imgData);
				}.bind(this));
			},
			
			getClientDimensions : function() {
			
			},
			
			/*
				apply theme to all sections of target, where target is 'inline' or 'dialog'
			*/
			applyTheme : function(target, callback) {				
				//this.clearAll(target);
				this.debounce('applyTheme' + target, function() {
					var themeData = this.themes[this.theme],
						w, h, min, t, minw, minh, pic, stampRes,
						container, toStyle, hcmd, invratio, invratiosq, 
						cs, margins, bcr, fminh, fminw;
						
					var dialogMode = target == 'dialog';

					container = this.$[target + "Container"];
					
					minh = this.dimensions[target].refit.height;
					minw = Infinity;
					
					fminh = function(val) { minh = Math.min(minh, val) || val || minh } // these help us see the trees behind the forest
					fminw = function(val) { minw = Math.min(minw, val) || val || minw }
					
					if(!dialogMode)
					{
						fminh(this.style.height && this.style.height.replace(/px/, ''));
						fminw(this.style.width && this.style.width.replace(/px/, ''));
					}
					
					fminh(document.body.clientHeight);
					fminw(document.body.clientWidth);

					t = container.offsetParent;
					
					do {
						bcr = t.getBoundingClientRect();
						fminw(bcr.width);
						fminh(bcr.height)
						fminw(t.clientWidth)
						fminh(t.clientHeight)
						t = t.offsetParent;
					} while(t);
					
					min = Math.min(minw, minh);
					h = w = min;
					
					if(!this.dimensions[target].wanted.height)
						this.dimensions[target].wanted.height = h;
					
					
					//this.scrollers = {};
					
					this.scrollers[target] = {};
					
					this._ratio = this.ratio;
					
					this.stampThemeSection(		container, 
												themeData[target], 
												{ section : target, size : min, slideWidth : minw, dialogMode : dialogMode },
												callback
											);
					
					//dialog = this.stampThemeSection(this.$.dialogContainer, themeData.dialog, .35 * min);
					
					container.style.width = minw + 'px';
					container.style.height = this.dimensions[target].wanted.height + 'px';
					
					pic = Polymer.dom(container);
					
					toStyle = {};
					toStyle.main = pic.querySelector('.main').style;
					toStyle.commands = pic.querySelector('.commands').style;
					toStyle.thumbnails = pic.querySelector('.thumbnails').style;
					
					if(this.images.length <= 1)
					{	
						t = Polymer.dom(pic).querySelectorAll('.commands')
							.forEach(function(t) { 
								Polymer.dom(Polymer.dom(t).parentNode).removeChild(t) 
							});
					}
					
					//this.setSizeToParentClientSize([pic.querySelector('.main'), pic.querySelector('.commands'), pic.querySelector('.main')])
					
						toStyle.main.width = toStyle.thumbnails.width = toStyle.commands.width = minw + "px";
						toStyle.main.height = (this.images.length > 1 ? this._ratio : 1) * h + "px";

						invratio = 1 - this._ratio;
						invratiosq = invratio * invratio;

						// commands is either its natural size or shrinked to inverse ratio squared
						t = pic.querySelector('.commands');
						if(t)
						{
							hcmd = pic.querySelector('.commands').getBoundingClientRect().height;
							/*if(h * invratiosq < hcmd)
							{
								toStyle.commands.transform = 'scale(' + (h * invratiosq) / hcmd + ',' + (h * invratiosq) / hcmd + ')';
								hcmd = h * invratiosq;
							}*/	
							toStyle.commands.height = hcmd + "px";
							
							toStyle.thumbnails.height = (invratio * h - hcmd) + "px";

							if(!dialogMode)
								Polymer.dom(this.root).querySelector('.viewPort').style.height = this._wantedHeight;
						}
					
					if(callback)
						callback.call(this);
				}.bind(this), 100);
			},
			
			nextPage : function(page) {
				var p = this.currentPage, 
					l = this.images.length - 1;
				
				p = p >= l ? 0 : p + 1; 
				this.goToPage(p);
			},
			prevPage : function(page) {
				if(this.images.length <= 1)
					return
				var p = this.currentPage, 
					l = this.images.length - 1;
				
				p = p <= 0 ? l : p - 1; 
				this.goToPage(p)
			},
			
			goToPage : function(page) {
				if(this.images.length <= 1)
					return
				this.currentPage = page;
				this.forEachScroller(function(s) { 
					s.scroller.goToPage(page, 0) 
				}.bind(this));
			},
			
			forEachScroller : function(foo, section) {
				var s = [], alls = this.scrollers;
				
				if(!alls)
					return;
				
				if(alls.inline)
					s = [ 
							{ section : "inline", scroller : alls.inline.main },
							{ section : "inline", scroller : alls.inline.thumbnails } 
						];

				if(alls.dialog)
				{
					s.push({ section : 'dialog', scroller : alls.dialog.main});
					s.push({ section : 'dialog', scroller : alls.dialog.thumbnails});
				}
				
				s = s.filter(function(s) { return s && s.scroller }); 
				
				if(section)
					s = s.filter(function(s) { return s.section == section });
					
				s.forEach(foo);
			},
			
			// section is 'inline' or 'dialog'
			clearScrollers : function(section) {
				this.forEachScroller(function(s) { s.scroller.destroy(); }, section);
				if(section)
					this.scrollers[section] = null;
				else
					this.scrollers.inline  = this.scrollers.dialog = null;
			},
			
			syncScrollers : function(section, sourceScroller) {
				var 
					alls = this.scrollers, 
					s = alls[section];
					
				this.currentPage = s[sourceScroller].currentPage.pageX || 0;
				
				this.forEachScroller(function(s) {
					s.scroller.goToPage(this.currentPage, 0); 
				}.bind(this));
			},
			
			/*
				stamp theme into target. target is either $.inlineContainer or $.dialogContainer
			*/
			stampThemeSection : function(target, template, opts, callback) {
				var instance, t, main, wrappers, hcmd;
				t = template;		
				
				this.templatize(t);
				
				instance = this.stamp({});

				Polymer.dom(target).appendChild(instance.root);

				hcmd = target.querySelector('.commands');
				if(hcmd) hcmd = hcmd.getBoundingClientRect().height;
				
				Polymer.dom.flush();

				wrappers = {};
				
				wrappers.main = this.populateDisplaySection(target, { 
														selector : ".main", 
														size : this.images.length > 1 ? this._ratio * opts.size : opts.size,
														section : target,
														onclick : opts.dialogMode ? null : function(ev) {
																								this.openDialog.call(this);
																							}.bind(this),
														slideWidth : opts.slideWidth
													});

													
				wrappers.thumbnails = this.populateDisplaySection(target, { 
														selector : ".thumbnails", 
														size : this.images.length > 1 ? (1 - this._ratio) * opts.size - hcmd : 0,
														noCaption : true,
														section : target,
														onclick : function(ev) { 
															this.goToPage(Polymer.dom(ev).localTarget.index, 0)
														}.bind(this),
													});

				this.scopeSubtree(target, true);
				Polymer.updateStyles()

				this.async( function(target) {
					var scrollers = {};
					["main", "thumbnails"].forEach(function(s) {
						// init iscroll
						var iscroll = new IScroll(wrappers[s], {
							mouseWheel: true,
							scrollX: this.images.length > 1,
							scrollY: false,
							momentum: true,
							snap: ".slide",
							snapSpeed: 400,
							keyBindings: opts.dialogMode && this.images.length > 1
						});
						iscroll.refresh();
						scrollers[s] = iscroll; //{ scroller : iscroll, section : opts.section };
					}.bind(this));
					this.scrollers[opts.section] = scrollers;
					if(this.images.length > 1)
						scrollers.main.on('scrollEnd', function() { 
							this.currentPage = scrollers.main.currentPage.pageX;
							this.debounce('scrollEnd', function() { 
								this.syncScrollers(opts.section, "main");
							}.bind(this), 200);
						}.bind(this));
					
					if(callback) callback();
				}, 100);

													
				this.assignCommands(target);
				//return scrollers;
				//Polymer.dom.flush();
	
				//return { instance : instance.root, scrollers : scrollers };
			},

			assignCommand : function(target, selector, foo)
			{
				var els = Polymer.dom(target).querySelectorAll(selector);
				els.forEach(function(el) {
					el.addEventListener('click', foo)
				}.bind(this));
			},
			
			assignCommands : function(target) {
				var commandsEl = Polymer.dom(target).querySelectorAll('.commands');
				if(!commandsEl.length)
					return;
				//commandsEl.forEach(function() {
				this.assignCommand(target, '[command-forward]', this.nextPage.bind(this));
				this.assignCommand(target, '[command-backward]', this.prevPage.bind(this))
				this.assignCommand(target, '[command-close]', this.closeDialog.bind(this))
				//}.bind(this))
			},

			closeDialog : function () {
				this.$.dialog.close();
			},
			openDialog : function ()
			{
				var size = Math.min(document.body.clientWidth, document.body.clientHeight);
				
				this.$.dialog.open();
				
				if(this.scrollers.dialog)
					return this.goToPage(this.currentPage);
					
				this.$.dialog.style.width = document.body.clientWidth;
				this.$.dialog.style.height = document.body.clientHeight;
				this.applyTheme('dialog', function() {
					this.refit('dialog');
					this.goToPage(this.currentPage)
				}.bind(this));
				
			},
			
			setSize : function(el, size)
			{
				if(typeof size != 'object')
					size = { height : size, width : size };
					
				el.style.width = size.width;
				el.style.height = size.height;
				
				return el;
			},
			
			setSizeToParentClientSize : function(nodes) 
			{
				if(!(nodes instanceof Array))
				{
					if(nodes.length)
						nodes = [].slice.call(nodes);
					else
						nodes = [nodes];
				}
				
				nodes.forEach(function(n) {
					n.width = n.parentOffset.clientWidth
					n.height = n.parentOffset.clientHeight
				});
			},
			
			imageFromData : function(imgData, opts)
			{
				var wrapper, caption, tocenter, w, h, imgel, slide,
					hasCaption = imgData.captionHTML && !opts.noCaption;

				imgel = document.createElement('iron-image');
				slide = document.createElement('div');

				imgel.src = imgData.src;
				imgel.index = imgData.index;
				imgel.sizing = 'contain';
				
				w = opts.slideWidth || opts.size;
				h = opts.size * (hasCaption ? this._ratio * 1.3 : 1);
				
				wrapper = document.createElement('figure');					
				Polymer.dom(wrapper).appendChild(imgel);
				Polymer.dom(slide).appendChild(wrapper);

				if(hasCaption)
				{
					caption = document.createElement('figcaption');
					caption.style.height  = opts.size - h;
					Polymer.dom(caption).innerHTML = imgData.captionHTML;				
					Polymer.dom(wrapper).appendChild(caption);
					wrapper.style.height = h - caption.offsetHeight;
				}

				this.setSize(imgel, { width : w, height : h }); //* (opts.noCaption ? this._ratio : 1) });				
				this.setSize(wrapper, { width : w, height : h});				

				slide.display = 'block';
				slide.style.textAlign = 'center';
				
				return slide;
			},
			
			// populates a scroller/thumbnails container
			//
			// opts: selector, size, noCaption, onClick
			populateDisplaySection : function(root, opts) {
				var wrapper, scroller, pt;

				// build scroller
				
				//  get the wrapper
				wrapper = Polymer.dom(root).querySelector(opts.selector)
				
				// remember: wrapper -> scroller -> slides, and iScroll is initialized on wrapper
				Polymer.dom(wrapper).classList.add('wrapper');
				
				// create wrapper in scroller
				scroller = document.createElement('div');
				Polymer.dom(scroller).classList.add('scroller')

				pt = Polymer.dom(scroller);
				
				Polymer.dom(wrapper).appendChild(scroller);
				
				// add slides to scroller
				this.images.forEach(function(imgData) {
					var slide = this.imageFromData(imgData, opts);
					Polymer.dom(slide).classList.add('slide');
					Polymer.dom(slide).classList.add(this.themes[this.theme].scopeClass);
					Polymer.dom(scroller).appendChild(slide)
					if(opts.onclick)
						slide.addEventListener("click", opts.onclick.bind(this));
				}.bind(this));
			
				scroller.style.width = (opts.slideWidth || opts.size) * this.images.length; 
				scroller.style.height = (opts.size) * (1 - this._ratio); 
			
				Polymer.updateStyles();
				
				return wrapper
			},

			goBack : function(e) {
			},

			goForward : function(e) {

			}, 

			keyNav : function(e) {
			  if(e.keyCode == 37)
			  {
				this.pageToSwap -= 1;
				if(this.pageToSwap < 0)
				  this.pageToSwap = this.images.length - 1;
				this.$['gallery-thumbnails'].scroll.prev();
				this.goToPage('gallery-scroller', this.pageToSwap);
				this.selectGalleryThumb(this.pageToSwap);
			  }
			  else
				if(e.keyCode == 39)
				{
				  this.pageToSwap += 1;
				  if(this.pageToSwap > (this.images.length - 1))
					this.pageToSwap = 0;
				  this.$['gallery-thumbnails'].scroll.next();
				  this.goToPage('gallery-scroller', this.pageToSwap);
				  this.selectGalleryThumb(this.pageToSwap);
				}
			},		  

		});
})();		
</script>
	


<dom-module id="ir-gallery-theme-defaults">
	<template>

	<!--textarea style="display : none;"-->
	  <ir-gallery-theme name="default"> 
		<template inline> 
			<style> 
				.main { display: flex; flex: 1; padding : 5px }
				.commands { display: flex; justify-content : space-between;}
				.slide { 
					border : 3px solid green;
				}
				.thumbnails { display : flex, align-items : middle}
				#inline-wrapper { background : #fafafa; margin-bottom : 2px }
			</style>
			<div id="inline-wrapper">
				<div class="main"></div> 
				<div class="commands"><paper-icon-button command-backward icon="chevron-left"></paper-icon-button><paper-icon-button command-forward icon="chevron-right"></paper-icon-button></div>
				<div class="thumbnails"></div>
			</div>
		</template> 
		<template dialog> 
		  <style>
			.main > * {
				display : block;
				border-style: solid; 
				border-radius: 8px; 
				border-color: #767676; 
				border-width: 4px; 
				box-shadow: 0 0 0 0; 
				padding : 10px;
				background : white;
			}
			.figure {
				display : flex;
				align-items: center;
				justify-content: center;
			}
			.canceldiv { text-align : right }
			#dialog-wrapper { position : relative; background : white; border : 3px grey solid; border-radius : 5px; }

		   </style> 
		  <div id="dialog-wrapper"> 
			<div class="main"></div>
			<div class="commands"><paper-icon-button command-backward icon="chevron-left"></paper-icon-button><paper-icon-button command-forward icon="chevron-right"></paper-icon-button></div>
			<div class="thumbnails"></div>
			<div class='canceldiv'><paper-icon-button command-close icon="cancel"></paper-icon-button></div>
		  </div> 
		</template>
	  </ir-gallery-theme> 
	  <ir-gallery-theme name="transparent"> 
		<template inline> 
		  <style>
			.main { display: flex; flex: 1;}
		  </style> 
		  <div class="main"></div> 
		  <div class="scroller"></div> 
		</template> 
		<template dialog> 
		  <style>
			.transparentBlock {display: flex; flex: 1; flex-direction: column;} .dmain { display: flex; flex: 1;}
		  </style>
		  <div class="transparentBlock"> 
			<div class="dmain"></div> 
			<div class="dscroller"></div> 
			<div style="text-align: right;"> 
			  <paper-icon-button id="cancelButton" icon="cancel"></paper-icon-button> 
			</div>
		  </div> 
		</template>
	  </ir-gallery-theme>
	<!--/textarea-->
  		
	</template>
</dom-module>


<script>
(function() {
  Polymer({
		is : "ir-gallery-theme-defaults",

		attached : function(e) {
			var templates = document.createElement('div');
			//templates.innerHTML = Polymer.dom(this.root).innerHTML;
			Polymer.dom(document.body).appendChild(this.root);
		}
	})

	// This might not suffice for some browsers but seems like everything after IE8 is fine.
	document.addEventListener("DOMContentLoaded", function() {
		Polymer.dom(document.body).appendChild(document.createElement("ir-gallery-theme-defaults"));
	});
  

})();
</script>